## Azure 仮想マシンにディスクを追加し、サイズを変更する
ディスクの種類
	• Ultra
		○ VM再起動なしでパフォーマンスを動的に変更可能。SAP HANA、最上位のDB、高トランザクション用。データディスクのみ。OSはPremiumと併用
	• Premium SSD
		○ シリーズにsが含まれるVMで利用可能
	• Standard SSD
		○ Standard HDDとPremium SSDの中間
	• Standard HDD
		○ すべてのVMサイズで利用可能コスト安

マネージドの利点
	• 信頼性の向上:Azure では、高信頼性の VM に関連付けられた VHD が Azure Storage のさまざまな部分に配置されて、同等のレベルの回復力が提供されます。
	• セキュリティの向上:マネージド ディスクは、リソース グループ内の管理対象リソースです。 つまり、ロールベースのアクセス制御を使用して、VHD データを使用できるユーザーを制限することができます。
	• スナップショット サポート:スナップショットは、VHD の読み取り専用コピーの作成に使用できます。 所有している VM をシャットダウンする必要がありますが、スナップショットの作成に要する時間はわずか数秒です。 完了したら、VM の電源を入れ、スナップショットを使用して重複する VM を作成し、運用環境の問題をトラブルシューティングしたり、スナップショットが作成された時点に VM をロールバックしたりできます。
	• バックアップのサポート:Azure Backup を使用して、VM のサービスに影響を与えることなく、ディザスター リカバリーのために、マネージド ディスクを異なるリージョンに自動的にバックアップできます。

データのレプリケーション
	• ローカル冗長ストレージ (LRS) 
		○  同じ Azure データ センター内でデータがレプリケートされます。 ノードで障害が発生しても、データは引き続き使用できます。 ただし、データ センター全体で障害が発生すると、データが使用できなくなる場合があります。
	• geo 冗長ストレージ (GRS) 
		○ プライマリ リージョンから数百マイル離れた第 2 のリージョンにデータがレプリケートされます。 ご利用のストレージ アカウントで GRS が有効になっている場合、地域的な停電やプライマリ リージョンが復旧できない災害が発生しても、データは保持されます。
	• 読み取りアクセス geo 冗長ストレージ (RA-GRS) 
		○ セカンダリ ロケーションにあるデータに対する読み取り専用アクセス、および 2 つのリージョンにまたがる geo レプリケーションが提供されます。 データ センターで障害が発生しても、データは引き続き読み取り可能ですが、変更できなくなります。
	• ゾーン冗長ストレージ (ZRS) 
		○ 1 つのリージョン内の 3 つのストレージ クラスターにデータが同期的にレプリケートされます。 各ストレージ クラスターは物理的に他のストレージ クラスターと分離されており、それぞれの可用性ゾーン (AZ) 内にあります。 この種類のレプリケーションでは、ゾーンが使用できなくなっても、お使いのデータには引き続きアクセスし、管理することができます。

ディスクのパフォーマンス
	P4	P6	P10	P15	P20	P30	P40	P50	P60	P70	P80	
	ディスク サイズ	32 GiB	64 GiB	128 GiB	256 Gib	512 GiB	1 TiB	2 TiB	4 TiB	8 TiB	16 TiB	32 TiB
	ディスクあたりの最大 IOPS	120	240	500	1,100	2300	5000	7500	7500	16,000	18,000	20,000
	ディスクあたりの最大スループット	25 MB/秒	50 MB/秒	100 MB/秒	125 MB/秒	150 MB/秒	200 MB/秒	250 MB/秒	250 MB/秒	500 MB/秒	750 MB/秒	900 MB/秒
	
	貼り付け元  <https://docs.microsoft.com/ja-jp/learn/modules/add-and-size-disks-in-azure-virtual-machines/4-choosing-premium-storage> 
	
仮想マシンのディスクサイズを変更する
・VMを停止して割り当てを解除
・変更後は同じくパーティション拡張などをシェルを介して実行する（VM拡張としてシェル呼び出し）


Azure 内のディスク パフォーマンスに対するキャッシュの影響

秒あたりのIO
ディスクにより特性が決まっている。
VMにも最大値の制限が存在する。
実際には、スループットと待機時間が関係するのでもっと少なくなる。

スループット
秒あたりの帯域幅
IOPS x I/O size = throughput
なので、I/Oサイズを適切に切る必要がある。

待機時間
応答を待つ時間、処理がブロックされる

ディスクパフォーマンスのテスト
iometerなどでテストする

デイスクキャッシュの有効化
読み取りキャッシュ


Windows および Linux VM を保護するための暗号化オプション
Azure VM の暗号化ベースの主要なディスク保護テクノロジは次のとおりです。

	• Storage Service Encryption (SSE)
		○  Azure に組み込まれている暗号化サービス
		○  256 ビット AES 暗号化を使用する暗号化が既定で有効になっており、ストレージ アカウント管理者によって管理
	• Azure Disk Encryption (ADE)
		○ Azure Disk Encryption (ADE) は、VM の所有者によって管理
			§ Windows VM では BitLocker を使用し
			§ Linux VM では DM-Crypt を使用
	• ADE は Recovery コンテナーにバックアップされる VM では必須
	•  ADE は、これらのディスク暗号化キーとシークレットを管理するために Azure Key Vault と統合
		
• 既存のVMディスクの暗号化
	• キー コンテナーを作成します。
		○ Azure Disk Encryption では、暗号化シークレットがリージョン境界を越えることがないため、キー コンテナーと VM が同じ Azure リージョンにある必要があり
		○ Standard または Premium のいずれかの価格レベルを選択できます。 主な違いは、Premium レベルではハードウェア暗号化のバックアップ キーを使用できる点
	• ディスク暗号化をサポートするようにキー コンテナーのアクセス ポリシーを設定します。
	• キー コンテナーを使用して、ADE の暗号化キーを格納します。
	• ディスクの暗号化を実施
		○ OS、データ、両方、を選択