# Azure Traffic Manager

## Traffic Managerの仕組み

DNSベースの負荷分散サービス

## Traffic Manager エンドポイント

エンドポイントは、クライアントに返されるアクセス先を指す。各アプリケーションのデプロイをエンドポイントとして構成する。
エンドポイントは以下の3種類。

- Azureエンドポイント：Azureでホストされるサービス。Azure AppServiceなど。
- 外部エンドポイント：Azure外でホストされるサービス。
- 入れ子になったエンドポイント：プロファイルの組み合わせで、より複雑・柔軟なスキームを構成
  
## ルーティング方法

6つのトラフィックルーティング方法がある

1. 重みづけルーティング
1. パフォーマンスルーティング
1. 地理的ルーティング
1. 複数値ルーティング
1. サブネットルーティング
1. 優先順位によるルーティング

### 1. 重みづけルーティング

重みづけに基づいたランダムな応答  
![picture 11](images/0c4ee87a6798ff8334ed5a33d2db2a2f57709ea8d885eba409b444331e1e4ed7.png)  

### 2. パフォーマンスルーティング

ユーザーにとってパフォーマンスが最適になるエンドポイントに誘導インターネット待機時間テーブルを使用する。  
![picture 12](images/1905df6db261b3d2f058ba61445b1335f0a80d501f060bd267bacedd1d974f61.png)  

### 3. 地理的ルーティング

クエリ元の場所に基づいて特定のエンドポイントに誘導  
![picture 13](images/4414c05c6348187f30147e338511a169444d06b134dd41c5ad385cea5ec649cc.png)  

### 4. 複数値ルーティング

1 回の DNS クエリ応答で複数の正常なエンドポイントを応答する

### 5. サブネットルーティング

特定のサブネットからのクエリを特定のエンドポイントにマップ

### 6. 優先順位によるルーティング

エンドポイントに優先順位をつけて置き、利用不可の場合につぎの優先度のエンドポイントを返す
![picture 14](images/aecb5fddba81393a8914805061c050839301d68ba90506cd5b4d5d9a1c0ca97e.png)  

