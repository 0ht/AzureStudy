## Azure 仮想ネットワークについて知る
	• サブネットを構成してネットワークを分離・セグメント化
	• パブリックIP、パブリックLBを構成することでインターネット通信
	• リソース間の通信
		○ 仮想ネットワーク
		○ サービスエンドポイント
	• オンプレミスとの通信
		○ ポイント対サイト：直接
		○ サイト間：ゲートウェイ経由
		○ Azure ExpressRoute：専用線
	• ルーティングをオーバーライド可能
		○ ルートテーブル
		○ Border Gateway Protocol：オンプレBGPルートを仮想ネットワークに反映、Azure VPN Gateway or ExpressRoute 
	
	
Azure VPN Gateway について知る
	• Azureへのエンドポイント
	• 暗号化された接続のエンドポイントとなる特殊なネットワークゲートウェイ
	• 異なるリージョンを接続する際にも使用される
	• 各仮想ネットワークには、VPNゲートウェイを一つだけ作詞可能、すべての接続、帯域を共有する
	• キー設定はゲートウェイの種類、これによって機能が決定される。VPNの場合はvpn
		○ IPsec/IKE VPN トンネリング経由のネットワーク間接続。VPN ゲートウェイを他の VPN ゲートウェイとリンクします。
		○ クロスプレミス IPsec/IKE VPN トンネリング。専用の VPN デバイスを通じてオンプレミス ネットワークを Azure と接続し、サイト間接続を作成します。
		○ IKEv2 または SSTP 経由のポイント対サイト接続。クライアント コンピューターを Azure のリソースにリンクします。
VPN計画における要素
	• スループット - Mbps または Gbps
	• バックボーン - インターネットかプライベートか
	• パブリック (静的) IP アドレスの可用性
	• VPN デバイスの互換性
	• 複数のクライアント接続か、またはサイト間のリンクか
	• VPN ゲートウェイの種類
	• Azure VPN Gateway の SKU

	ポイント対サイト	サイト間	ExpressRoute
Azure でサポートされるサービス	クラウド サービスと VM	クラウド サービスと VM	サポートされているすべてのサービス
一般的な帯域幅	VPN Gateway SKU に依存	VPN Gateway SKU に依存	「ExpressRoute 帯域幅オプション」を参照してください
サポート対象プロトコル	SSTP および IPSec	IPsec	直接接続、VLAN
ルーティング	RouteBased (動的)	PolicyBased (静的) および RouteBased	BGP
接続の回復性	アクティブ/パッシブ	アクティブ/パッシブまたはアクティブ/アクティブ	アクティブ/アクティブ
ユース ケース	テストとプロトタイプ作成	開発、テスト、小規模の運用	エンタープライズ/ミッション クリティカル

貼り付け元  <https://docs.microsoft.com/ja-jp/learn/modules/configure-network-for-azure-virtual-machines/4-explore-azure-vpn-gateway> 

ワークフロー
	1. 接続するすべてのネットワークのアドレス空間をリストする、接続トポロジを設計します。
	2. Azure 仮想ネットワークを作成します。
	3. 仮想ネットワークの VPN ゲートウェイを作成します。
	4. 必要に応じて、オンプレミス ネットワークやその他の仮想ネットワークへの接続を作成および構成します。
	5. 必要に応じて、Azure VPN ゲートウェイのポイント対サイト接続を作成および構成します。

	• VPN ゲートウェイには、GatewaySubnet という名前のゲートウェイ サブネットが必要です。
	
VPN ゲートウェイの作成
	• RouteBased
		○ ルート ベース VPN デバイスは、Any 間 (ワイルドカード) のトラフィック セレクターを使用して、ルーティング/転送テーブルを異なる IPsec トンネルへのトラフィックに転送します。 ルート ベースの接続は、通常、それぞれの IPsec トンネルがネットワーク インターフェイスまたは VTI (仮想トンネル インターフェイス) としてモデル化されるルーターのプラットフォームに基づいて構築されます。

	• PolicyBased
		○ ポリシー ベース VPN デバイスは、両方のネットワークからプレフィックスの組み合わせを使用して、トラフィックがどのように IPsec トンネルを介して暗号化/復号化されるかを定義します。 ポリシー ベースの接続は、通常、パケット フィルタリングを実行するファイアウォール デバイスに基づいて構築されます。 IPsec トンネルの暗号化と復号化は、パケット フィルタリングと処理エンジンに追加されます。

$VNetName  = "VNetData"
$FESubName = "FrontEnd"
$BESubName = "Backend"
$GWSubName = "GatewaySubnet"
$VNetPrefix1 = "192.168.0.0/16"
$VNetPrefix2 = "10.254.0.0/16"
$FESubPrefix = "192.168.1.0/24"
$BESubPrefix = "10.254.1.0/24"
$GWSubPrefix = "192.168.200.0/26"
$VPNClientAddressPool = "172.16.201.0/24"
$ResourceGroup = "VpnGatewayDemo"
$Location = "japaneast"
$GWName = "VNetDataGW"
$GWIPName = "VNetDataGWPIP"
$GWIPconfName = "gwipconf"

PPP アダプター VNetData:

   接続固有の DNS サフィックス . . . . .:
   説明. . . . . . . . . . . . . . . . .: VNetData
   物理アドレス. . . . . . . . . . . . .:
   DHCP 有効 . . . . . . . . . . . . . .: いいえ
   自動構成有効. . . . . . . . . . . . .: はい
   IPv4 アドレス . . . . . . . . . . . .: 172.16.201.2(優先)
   サブネット マスク . . . . . . . . . .: 255.255.255.255
   デフォルト ゲートウェイ . . . . . . .:
   DNS サーバー. . . . . . . . . . . . .: 10.2.1.3
   NetBIOS over TCP/IP . . . . . . . . .: 有効


Azure ExpressRoute について知る
	• ExpressRoute が提供する利点は次のとおりです。
		○ 帯域幅の動的スケーリングがある 50 Mbps から 10 Gbps のより速い速度
		○ より短い待機時間
		○ 組み込みピアリングを通じたより高い信頼性
		○ 高度なセキュリティで保護
	• ExpressRoute には、さらに次のような利点もあります。
		○ サポートされているすべての Azure サービスへの接続性
		○ すべてのリージョンへのグローバル接続 (Premium アドオンが必要)
		○ Border Gateway Protocol 経由での動的ルーティング
		○ 接続アップタイムに関するサービス レベル アグリーメント (SLA)
		○ Skype for Business のサービスの品質 (QoS)

接続モデル
	• IP VPN ネットワーク (任意の環境間)
		○ 通常、IPVPN プロバイダーは、マネージド レイヤー 3 接続経由でブランチ オフィスと会社のデータセンターの間の接続を提供します。 ExpressRoute では、Azure データセンターは別のブランチ オフィスであるかのように見えます。
	• イーサネット交換による仮想交差接続
		○ クラウド エクスチェンジ施設でのコロケーションを利用している場合は、プロバイダーのイーサネット エクスチェンジを通して Microsoft Cloud への交差接続を要求します。 このような Microsoft Cloud への交差接続は、ネットワーク OSI モデルのように、レイヤー 2 とレイヤー 3 マネージドのどちらの接続でも運用できます。
	• ポイント ツー ポイントのイーサネット接続


ExpressRoute 回線とルーティング ドメインの組み合わせを使用
Azure プライベート ピアリング
Azure パブリック ピアリング
Microsoft ピアリング